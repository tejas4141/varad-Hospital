<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hospital Dashboard</title>
<link rel="stylesheet" href="style1.css">
<style>
  button {
  padding: 6px 12px;
  margin: 2px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 13px;
}
button.edit-btn {
  background: #28a745;
  color: #fff;
}
button.edit-btn:hover {
  background: #218838;
}
button.delete-btn {
  background: #dc3545;
  color: #fff;
}
button.delete-btn:hover {
  background: #c82333;
}

</style>
</head>
<body>
      <!-- Header -->
    <header class="navbar">
        <div class="nav-logo"></div>
        <div class="nav-welcome">
            <h1>Welcome To Varad Multispeciality  Hospital Atpadi</h1>
            <h2>Advanced Medical Services & Emergency Care</h2>
        </div>
        <div class="nav-yojna"></div>
    </header>

    <!-- Navigation -->
    <nav class="navbar1">
        <ul>
            <li><a class="nav-link active" href="#"><i class="bi bi-house-door-fill"></i> HOME</a></li>
            <li><a class="nav-link" href="service.html">SERVICES</a></li>
            <li><a class="nav-link" href="aboutus.html">ABOUT US</a></li>
            <li><a class="nav-link" href="hospital.html">HOSPITAL LOGIN</a></li>
            <li><a class="nav-link" href="complaint.html">COMPLAINTS</a></li>
        </ul>
    </nav>

<h1>Hospital Dashboard</h1>
<table border="1">
 <thead>
  <tr>
    <th>Queue No</th>
    <th>Name</th>
    <th>Email</th>
    <th>Phone</th>
    <th>Doctor</th>
    <th>Date</th>
    <th>Message</th>
    <th>Actions</th> <!-- âœ… New column -->
  </tr>
</thead>

  <tbody id="appointments"></tbody>
</table>

<script>
async function loadAppointments() {
  try {
    const response = await fetch("/appointments", {
      headers: {
        "Authorization": "Basic " + btoa("hospital:1234")
      }
    });

    if (!response.ok) throw new Error("HTTP " + response.status);

    const data = await response.json();
    const tbody = document.getElementById("appointments");
    tbody.innerHTML = "";

    data.forEach(a => {
      tbody.innerHTML += `
        <tr>
          <td>${a.queueNumber}</td>
          <td>${a.name}</td>
          <td>${a.email}</td>
          <td>${a.phone}</td>
          <td>${a.doctor}</td>
          <td>${a.date}</td>
          <td>${a.message || ""}</td>
        </tr>
      `;
    });
  } catch (err) {
    alert("Error loading appointments: " + err.message);
  }
}
async function deleteAppointment(id) {
  if (!confirm("Are you sure you want to delete this appointment?")) return;
  try {
    const res = await fetch(`/appointments/${id}`, {
      method: "DELETE",
      headers: {
        "Authorization": "Basic " + btoa("hospital:1234")
      }
    });
    if (!res.ok) throw new Error("HTTP " + res.status);
    alert("Appointment deleted!");
    loadAppointments();
  } catch (err) {
    alert("Error deleting appointment: " + err.message);
  }
}
data.forEach(a => {
  tbody.innerHTML += `
    <tr>
      <td>${a.queueNumber}</td>
      <td>${a.name}</td>
      <td>${a.email}</td>
      <td>${a.phone}</td>
      <td>${a.doctor}</td>
      <td>${a.date}</td>
      <td>${a.message || ""}</td>
      <td>
        <button class="edit-btn" onclick="editAppointment('${a._id}')">Edit</button>
        <button class="delete-btn" onclick="deleteAppointment('${a._id}')">Delete</button>
      </td>
    </tr>
  `;
});


async function editAppointment(id) {
  let newName = prompt("Enter new patient name:");
  if (!newName) return;
  try {
    const res = await fetch(`/appointments/${id}`, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Basic " + btoa("hospital:1234")
      },
      body: JSON.stringify({ name: newName })
    });
    if (!res.ok) throw new Error("HTTP " + res.status);
    alert("Appointment updated!");
    loadAppointments();
  } catch (err) {
    alert("Error updating appointment: " + err.message);
  }
}


loadAppointments();
</script>
</body>
</html>
